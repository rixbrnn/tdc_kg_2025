PREFIX : <http://example.org/chinook#>
PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>

# Q: Para cada gerente, qual é a receita total gerada por sua equipe,
#    incluindo todos os subordinados indiretos?

SELECT ?manager ?managerName ?title (SUM(?lineTotal) AS ?teamRevenue)
WHERE {
  # Possível gerente
  ?manager a :Employee ;
           :fullName ?managerName ;
           :title ?title .

  # Qualquer funcionário na subárvore do gerente (incluindo o gerente)
  ?rep a :Employee ;
       :reportsTo* ?manager .

  # Clientes suportados por esse representante
  ?customer a :Customer ;
            :supportedBy ?rep ;
            :hasInvoice ?inv .

  # Linhas de fatura e receita
  ?inv :hasLine ?line .
  ?line :unitPrice ?price ;
        :quantity  ?qty .

  BIND(xsd:decimal(?price) * xsd:decimal(?qty) AS ?lineTotal)
}
GROUP BY ?manager ?managerName ?title
ORDER BY DESC(?teamRevenue)
