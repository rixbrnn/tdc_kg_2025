PREFIX : <http://example.org/chinook#>

# Q: Given an artist (e.g., "Iron Maiden"), recommend similar artists
#    based on shared customer purchases

SELECT ?recommendedArtist 
       (COUNT(DISTINCT ?customer) AS ?commonCustomers)
       (SUM(?revenue) AS ?totalRevenue)
WHERE {
  # Step 1: Find customers who bought Iron Maiden
  ?customer :hasInvoice/:hasLine/:lineTrack/:hasAlbum/:hasArtist ?targetArtist .
  ?targetArtist :name "Iron Maiden" .
  
  # Step 2: What other artists did they buy?
  ?customer :hasInvoice ?invoice .
  ?invoice :hasLine ?line .
  ?line :lineTrack/:hasAlbum/:hasArtist ?otherArtist .
  ?otherArtist :name ?recommendedArtist .
  
  # Calculate revenue for ranking
  ?line :unitPrice ?price ;
        :quantity ?qty .
  BIND(?price * ?qty AS ?revenue)
  
  # Exclude the original artist
  FILTER(?otherArtist != ?targetArtist)
}
GROUP BY ?recommendedArtist
ORDER BY DESC(?commonCustomers) DESC(?totalRevenue)
LIMIT 10
