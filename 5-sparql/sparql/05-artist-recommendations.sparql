PREFIX : <http://example.org/chinook#>

# Q: Dado um artista (ex: "Iron Maiden"), recomendar artistas similares
#    baseado em compras compartilhadas de clientes

SELECT ?recommendedArtist 
       (COUNT(DISTINCT ?customer) AS ?commonCustomers)
       (SUM(?revenue) AS ?totalRevenue)
WHERE {
  # Passo 1: Encontrar clientes que compraram Iron Maiden
  ?customer :hasInvoice/:hasLine/:lineTrack/:hasAlbum/:hasArtist ?targetArtist .
  ?targetArtist :name "Iron Maiden" .
  
  # Passo 2: Que outros artistas eles compraram?
  ?customer :hasInvoice ?invoice .
  ?invoice :hasLine ?line .
  ?line :lineTrack/:hasAlbum/:hasArtist ?otherArtist .
  ?otherArtist :name ?recommendedArtist .
  
  # Calcula receita para ranqueamento
  ?line :unitPrice ?price ;
        :quantity ?qty .
  BIND(?price * ?qty AS ?revenue)
  
  # Exclui o artista original
  FILTER(?otherArtist != ?targetArtist)
}
GROUP BY ?recommendedArtist
ORDER BY DESC(?commonCustomers) DESC(?totalRevenue)
LIMIT 10
